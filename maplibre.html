<html>

<head>
  <title>PMTiles MapLibre Example</title>
  <meta charset="utf-8" />
  <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.0.1/dist/maplibre-gl.css' />
  <script src='https://unpkg.com/maplibre-gl@5.0.1/dist/maplibre-gl.js'></script>
  <script src="https://unpkg.com/pmtiles@4.2.1/dist/pmtiles.js"></script>
  <style>
    body {
      margin: 0;
    }

    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script type="text/javascript">
    // add the PMTiles plugin to the maplibregl global.
    // setting metadata = true fills out the "attribution" field of the source, and is required for some inspector applications,
    // but requires an additional blocking HTTP request before loading the map.
    let protocol = new pmtiles.Protocol({ metadata: true });
    maplibregl.addProtocol("pmtiles", protocol.tile);

    const map = new maplibregl.Map({
      style: "https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",
      container: "map",
      zoom: 13,
      center: [14.436035, 50.078292],
    });
    map.showTileBoundaries = false;
    map.on('load', function () {
      map.addSource('pmtiles-source', {
        type: 'vector',
        // url: 'pmtiles://https://uscuni.org/69333.pmtiles'
        url: 'pmtiles://http://127.0.0.1:8000/complete.pmtiles'
      });

      map.addLayer({
        id: 'pmtiles-layer',
        type: 'fill',
        source: 'pmtiles-source',
        'source-layer': 'buildings', // Adjust this to match the actual layer name in your PMTiles
        paint: {
          "fill-color": [
            "match",
            ["get", "final_without_noise"],
            "0", "#e6194b",
            "1", "#3cb44b",
            "2", "#ffe119",
            "3", "#4363d8",
            "4", "#f58231",
            "5", "#911eb4",
            "6", "#46f0f0",
            "7", "#f032e6",
            "8", "#bcf60c",
            "9", "#fabebe",
            "10", "#008080",
            "11", "#e6beff",
            "12", "#9a6324",
            "13", "#fffac8",
            "14", "#800000",
            "15", "#aaffc3",
            "16", "#808000",
            "17", "#ffd8b1",
            "18", "#000075",
            "19", "#808080",
            "20", "#ffffff",
            "21", "#f12345",
            "22", "#ffe119",
            "23", "#f58231",
            "24", "#911eb4",
            "25", "#46f0f0",
            "26", "#f032e6",
            "27", "#bcf60c",
            "28", "#fabebe",
            "29", "#008080",
            "30", "#e6beff",
            "31", "#9a6324",
            "32", "#fffac8",
            "33", "#800000",
            "34", "#aaffc3",
            "35", "#808000",
            "36", "#ffd8b1",
            "37", "#000075",
            "38", "#808080",
            "39", "#ffffff",
            "40", "#000000",
            "#cccccc" // default color
          ],
        },
      });
    });
    // add button to make map full screen
    map.addControl(new maplibregl.FullscreenControl());
    // specify to use the globe projection
    map.on('style.load', () => {
      map.setProjection({
        type: 'globe', // Set projection to globe
      });
    });
    // include navigation control
    let nav = new maplibregl.NavigationControl();
    map.addControl(nav, 'top-left');
  </script>
</body>

</html>